<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sand Pavilion ‚Äî Living Library</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Merriweather', serif;
            background: linear-gradient(160deg, #1b1a24, #402f1d 45%, #c69b58 100%);
            color: #fef6e4;
            min-height: 100vh;
        }
        header {
            text-align: center;
            padding: 3rem 1rem 2rem;
        }
        header h1 { font-size: 3rem; margin-bottom: 0.6rem; letter-spacing: 0.06em; }
        header p { max-width: 760px; margin: 0 auto; font-size: 1.05rem; opacity: 0.85; }
        .blessing-banner {
            margin: 1.6rem auto 0;
            padding: 1rem 1.2rem;
            max-width: 760px;
            background: rgba(255, 245, 220, 0.1);
            border-radius: 18px;
            border: 1px solid rgba(255, 219, 144, 0.4);
            display: grid;
            gap: 0.6rem;
            font-size: 0.95rem;
        }
        .blessing-banner span {
            display: flex;
            gap: 0.5rem;
            align-items: center;
            color: #ffe6a7;
        }
        .blessing-banner em {
            font-style: normal;
            opacity: 0.85;
        }
        .shelves {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 1.5rem 3.5rem;
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
            gap: 1.6rem;
        }
        .shelf {
            background: rgba(24, 17, 9, 0.75);
            border-radius: 18px;
            padding: 1.8rem;
            border: 1px solid rgba(255, 219, 144, 0.3);
            box-shadow: 0 18px 40px rgba(0, 0, 0, 0.35);
        }
        .shelf h2 { color: #ffd787; margin-bottom: 0.8rem; font-size: 1.5rem; }
        .shelf ul { list-style: none; }
        .shelf li { margin-bottom: 0.6rem; }
        .library-holdings {
            max-width: 1200px;
            margin: 0 auto 3rem;
            padding: 0 1.5rem;
        }
        .library-holdings__header {
            text-align: center;
            margin-bottom: 2rem;
        }
        .library-holdings__header h2 {
            color: #ffe6a7;
            font-size: 2.2rem;
            margin-bottom: 0.8rem;
        }
        .library-holdings__header p {
            max-width: 860px;
            margin: 0 auto;
            line-height: 1.6;
            opacity: 0.9;
        }
        .catalog-controls {
            display: flex;
            flex-direction: column;
            gap: 1rem;
            margin-bottom: 1.5rem;
        }
        .catalog-controls__filters {
            display: flex;
            flex-wrap: wrap;
            gap: 0.8rem;
        }
        .catalog-controls__filters label,
        .catalog-controls__filters .catalog-controls__search {
            display: inline-flex;
            align-items: center;
            gap: 0.6rem;
            background: rgba(255, 255, 255, 0.08);
            border: 1px solid rgba(255, 219, 144, 0.4);
            border-radius: 16px;
            padding: 0.55rem 0.8rem;
        }
        .catalog-controls__filters select,
        .catalog-controls__filters input {
            background: transparent;
            border: none;
            color: #ffe6a7;
            font-weight: 600;
            font-size: 0.9rem;
            outline: none;
        }
        .catalog-controls__filters option {
            color: #1b1a24;
        }
        .catalog-controls__filters input::placeholder {
            color: rgba(255, 230, 167, 0.6);
        }
        .catalog-controls__status {
            font-size: 0.85rem;
            color: rgba(255, 230, 167, 0.8);
        }
        .book-grid {
            display: grid;
            gap: 1.8rem;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
        }
        .book-grid__empty,
        .book-grid__error {
            grid-column: 1 / -1;
            padding: 1.6rem;
            border-radius: 18px;
            border: 1px dashed rgba(255, 219, 144, 0.45);
            background: rgba(24, 17, 9, 0.55);
            text-align: center;
            line-height: 1.6;
            color: rgba(255, 230, 167, 0.85);
        }
        .book-card {
            background: rgba(24, 17, 9, 0.85);
            border-radius: 22px;
            padding: 1.8rem;
            border: 1px solid rgba(255, 219, 144, 0.35);
            display: flex;
            flex-direction: column;
            gap: 1.2rem;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.4);
        }
        .book-card__header h3 {
            font-size: 1.6rem;
            color: #ffd787;
            margin-bottom: 0.4rem;
        }
        .book-card__lesson {
            font-size: 0.85rem;
            letter-spacing: 0.08em;
            text-transform: uppercase;
            color: rgba(255, 230, 167, 0.8);
        }
        .book-card__author {
            font-size: 1rem;
            color: rgba(255, 230, 167, 0.9);
        }
        .book-card__meta {
            display: grid;
            gap: 0.6rem;
        }
        .book-card__meta div {
            background: rgba(255, 255, 255, 0.05);
            padding: 0.8rem;
            border-radius: 12px;
        }
        .book-card__meta dt {
            font-size: 0.75rem;
            text-transform: uppercase;
            letter-spacing: 0.06em;
            color: rgba(255, 230, 167, 0.6);
            margin-bottom: 0.25rem;
        }
        .book-card__meta dd {
            margin: 0;
            line-height: 1.5;
        }
        .book-card__excerpt {
            font-size: 0.95rem;
            line-height: 1.7;
            color: rgba(255, 246, 228, 0.92);
            background: rgba(0, 0, 0, 0.25);
            border-left: 3px solid rgba(255, 219, 144, 0.7);
            padding: 1rem 1.2rem;
            border-radius: 16px;
        }
        .book-card__controls,
        .book-card__actions {
            display: flex;
            flex-wrap: wrap;
            gap: 0.6rem;
        }
        .button {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 0.4rem;
            background: rgba(255, 219, 144, 0.28);
            color: #1b1a24;
            padding: 0.55rem 1.1rem;
            border-radius: 999px;
            border: 1px solid rgba(255, 219, 144, 0.6);
            font-weight: 600;
            font-size: 0.9rem;
            cursor: pointer;
            text-decoration: none;
            transition: background 0.3s ease, transform 0.2s ease;
        }
        .button:hover,
        .button:focus {
            background: rgba(255, 219, 144, 0.45);
            transform: translateY(-1px);
            outline: none;
        }
        .button:disabled,
        .button[aria-disabled="true"] {
            cursor: not-allowed;
            opacity: 0.6;
            background: rgba(255, 255, 255, 0.12);
            color: rgba(255, 246, 228, 0.6);
        }
        .button--ghost {
            background: transparent;
            color: #ffe6a7;
            border-color: rgba(255, 230, 167, 0.5);
        }
        .button--ghost:hover,
        .button--ghost:focus {
            background: rgba(255, 230, 167, 0.18);
            color: #1b1a24;
        }
        .notes-panel {
            margin: 3rem auto;
            max-width: 1100px;
            padding: 2.4rem;
            border-radius: 24px;
            border: 1px solid rgba(255, 219, 144, 0.35);
            background: rgba(24, 17, 9, 0.82);
            box-shadow: 0 24px 48px rgba(0, 0, 0, 0.35);
            display: grid;
            gap: 2rem;
        }
        .notes-panel__intro h2 {
            font-size: 2.2rem;
            color: #ffe6a7;
            margin-bottom: 0.6rem;
        }
        .notes-panel__intro p {
            opacity: 0.85;
            line-height: 1.6;
        }
        .notes-panel__layout {
            display: grid;
            gap: 1.6rem;
            grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
        }
        .notes-panel__column {
            background: rgba(0, 0, 0, 0.35);
            border-radius: 18px;
            border: 1px solid rgba(255, 219, 144, 0.25);
            padding: 1.6rem;
            display: grid;
            gap: 1.2rem;
            align-content: start;
        }
        .notes-panel__column--wide {
            background: none;
            border: none;
            padding: 0;
        }
        .notes-panel__column h3 {
            display: flex;
            align-items: center;
            gap: 0.6rem;
            color: #ffd787;
            font-size: 1.2rem;
        }
        .notes-panel__column p {
            font-size: 0.9rem;
            color: rgba(255, 230, 167, 0.78);
        }
        .notes-panel__folder-list,
        .notes-panel__note-list {
            list-style: none;
            margin: 0;
            padding: 0;
            display: grid;
            gap: 0.6rem;
        }
        .notes-panel__button {
            width: 100%;
            padding: 0.65rem 0.9rem;
            border-radius: 14px;
            border: 1px solid transparent;
            background: rgba(255, 219, 144, 0.12);
            color: #ffe6a7;
            font-weight: 600;
            font-size: 0.92rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 0.6rem;
            cursor: pointer;
            transition: background 0.25s ease, border 0.25s ease, transform 0.2s ease;
        }
        .notes-panel__button:hover,
        .notes-panel__button:focus {
            background: rgba(255, 219, 144, 0.22);
            border-color: rgba(255, 219, 144, 0.35);
            outline: none;
            transform: translateY(-1px);
        }
        .notes-panel__button.is-active {
            background: rgba(255, 219, 144, 0.32);
            border-color: rgba(255, 219, 144, 0.6);
            color: #1b1a24;
        }
        .notes-panel__form {
            background: rgba(255, 219, 144, 0.12);
            border-radius: 16px;
            border: 1px solid rgba(255, 219, 144, 0.25);
            padding: 1.2rem;
            display: grid;
            gap: 0.8rem;
        }
        .notes-panel__form label {
            font-size: 0.85rem;
            letter-spacing: 0.05em;
            text-transform: uppercase;
            color: rgba(255, 230, 167, 0.85);
        }
        .notes-panel__form input,
        .notes-panel__form textarea {
            width: 100%;
            border-radius: 12px;
            border: 1px solid rgba(255, 219, 144, 0.4);
            background: rgba(0, 0, 0, 0.25);
            padding: 0.75rem 0.9rem;
            color: #ffe6a7;
            font-family: inherit;
            font-size: 0.95rem;
            transition: border 0.2s ease, background 0.2s ease;
        }
        .notes-panel__form input:focus,
        .notes-panel__form textarea:focus {
            border-color: rgba(255, 219, 144, 0.65);
            background: rgba(0, 0, 0, 0.35);
            outline: none;
        }
        .notes-panel__form textarea {
            min-height: 140px;
            resize: vertical;
        }
        .notes-panel__form button {
            justify-self: start;
        }
        .notes-panel__notes-meta {
            font-size: 0.85rem;
            opacity: 0.75;
            letter-spacing: 0.05em;
            text-transform: uppercase;
        }
        .notes-panel__viewer {
            background: rgba(0, 0, 0, 0.35);
            border-radius: 18px;
            border: 1px solid rgba(255, 219, 144, 0.25);
            padding: 1.6rem;
            display: grid;
            gap: 0.8rem;
        }
        .notes-panel__viewer h3 {
            color: #ffd787;
            font-size: 1.6rem;
        }
        .notes-panel__viewer time {
            font-size: 0.85rem;
            letter-spacing: 0.06em;
            text-transform: uppercase;
            color: rgba(255, 230, 167, 0.65);
        }
        .notes-panel__viewer-content {
            background: rgba(0, 0, 0, 0.28);
            border-radius: 16px;
            border: 1px solid rgba(255, 219, 144, 0.22);
            padding: 1.2rem;
            line-height: 1.7;
            color: rgba(255, 246, 228, 0.92);
            white-space: pre-wrap;
        }
        .notes-panel__empty {
            border: 1px dashed rgba(255, 219, 144, 0.35);
            border-radius: 16px;
            padding: 1.4rem;
            text-align: center;
            color: rgba(255, 230, 167, 0.72);
            font-size: 0.95rem;
        }
        .tts-evaluation {
            max-width: 960px;
            margin: 0 auto 3rem;
            padding: 0 1.5rem;
            text-align: center;
        }
        .tts-evaluation h2 {
            color: #ffe6a7;
            font-size: 1.9rem;
            margin-bottom: 1rem;
        }
        .tts-evaluation p {
            line-height: 1.7;
            opacity: 0.85;
        }
        .tracks {
            background: rgba(255, 255, 255, 0.08);
            border-radius: 18px;
            max-width: 1000px;
            margin: 0 auto 3rem;
            padding: 2rem;
            text-align: center;
        }
        .tracks h2 { color: #ffe6a7; font-size: 2rem; margin-bottom: 1rem; }
        .tracks-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
            gap: 1.2rem;
        }
        .track-card {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 16px;
            padding: 1.4rem;
            border: 1px solid rgba(255, 219, 144, 0.2);
        }
        footer { text-align: center; padding: 2rem 1rem 3rem; font-size: 0.9rem; opacity: 0.75; }
        a.back { color: #ffd787; text-decoration: none; font-weight: bold; letter-spacing: 0.05em; display: inline-block; margin-top: 1.5rem; }
        a.back:hover { text-decoration: underline; }
        .guild-nav {
            margin: 3rem auto 0;
            max-width: 900px;
            padding: 1.2rem 1.5rem;
            border-radius: 18px;
            background: rgba(27, 26, 36, 0.85);
            border: 1px solid rgba(255, 219, 144, 0.35);
            display: grid;
            gap: 0.8rem;
        }
        .guild-label {
            text-transform: uppercase;
            letter-spacing: 0.08em;
            font-size: 0.75rem;
            color: #ffe6a7;
            text-align: center;
        }
        .guild-nav ul {
            list-style: none;
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
            gap: 0.8rem;
            padding: 0;
            margin: 0;
        }
        .guild-nav a {
            display: block;
            text-decoration: none;
            font-weight: 600;
            font-size: 0.85rem;
            color: #ffe6a7;
            padding: 0.6rem 0.8rem;
            border-radius: 14px;
            background: rgba(255, 219, 144, 0.18);
            text-align: center;
            transition: background 0.3s ease, color 0.3s ease;
        }
        .guild-nav a:hover,
        .guild-nav a:focus {
            background: rgba(255, 219, 144, 0.35);
            color: #1b1a24;
        }
    </style>
</head>
<body>
    <header>
        <h1>Archivum Vitae ‚Äî Living Library Guild</h1>
        <p>The Archivum Vitae keeps our references alive. Guild scribes collect sacred texts, oral histories, and modern manuals, pairing each with notes and discussion circles so every initiate can study with guidance.</p>
        <div class="blessing-banner" aria-label="Library blessings">
            <span>‚ú∂ <em>‚ÄúPeace I leave with you; my peace I give you.‚Äù ‚Äî Jesus (John 14:27)</em></span>
            <span>‚ú∂ <em>‚ÄúMay the lamp of knowledge remove the darkness of ignorance.‚Äù ‚Äî Invocation to Saraswati</em></span>
            <span>‚ú∂ <em>‚ÄúAs rain falls equally on the just and unjust, let your heart be impartial.‚Äù ‚Äî The Buddha</em></span>
        </div>
        <a class="back" href="index.html">‚Üê Return to the Pavilion</a>
    </header>

    <section class="shelves" aria-label="Living Library study rooms">
        <article class="shelf">
            <h2>Shelf I ¬∑ Hindu Wisdom Room</h2>
            <ul>
                <li>Bhagavad Gita ‚Äî annotated with line-by-line commentary circles.</li>
                <li>Upanishads ‚Äî audio recitations from multilingual volunteers.</li>
                <li>Vedas ‚Äî curated excerpts focused on ritual, cosmology, and ethics.</li>
            </ul>
        </article>
        <article class="shelf">
            <h2>Shelf II ¬∑ Buddhist Insights Room</h2>
            <ul>
                <li>Dhammapada ‚Äî daily verse reflections recorded by community elders.</li>
                <li>Heart Sutra ‚Äî interactive diagrams exploring emptiness teachings.</li>
                <li>Tibetan Book of the Dead ‚Äî peer study group transcripts.</li>
            </ul>
        </article>
        <article class="shelf">
            <h2>Shelf III ¬∑ Comparative Studies Room</h2>
            <ul>
                <li>Perennial Philosophy ‚Äî roundtable discussions and notes.</li>
                <li>World Religions ‚Äî shared timelines mapping cross-tradition echoes.</li>
                <li>Mysticism East &amp; West ‚Äî gallery of key metaphors and practices.</li>
            </ul>
        </article>
        <article class="shelf">
            <h2>Shelf IV ¬∑ Meditation &amp; Practice Room</h2>
            <ul>
                <li>Mindfulness Guide ‚Äî printable practice cards for quick sessions.</li>
                <li>Pranayama Techniques ‚Äî annotated breath sequences with safety cues.</li>
                <li>Zen Practice ‚Äî community podcast with weekly koan reflections.</li>
            </ul>
        </article>
    </section>

    <section class="library-holdings" aria-labelledby="public-domain-holdings">
        <div class="library-holdings__header">
            <h2 id="public-domain-holdings">Mirrored Public-Domain Holdings</h2>
            <p>Guild archivists keep at least three mirrored editions on-site so that every initiate has resilient access to our shared study canon. Each card below names the lineage, shares our lore-friendly study focus, and links to the local copy.</p>
        </div>
        <div class="catalog-controls">
            <div class="catalog-controls__filters">
                <label>
                    <span style="font-weight: 700; font-size: 0.85rem; text-transform: uppercase; letter-spacing: 0.08em;">Lesson</span>
                    <select data-catalog-filter>
                        <option value="all">All lessons</option>
                    </select>
                </label>
                <div class="catalog-controls__search">
                    <span aria-hidden="true">üîç</span>
                    <input type="search" data-catalog-search placeholder="Search title or lore">
                </div>
            </div>
            <p class="catalog-controls__status" data-catalog-status></p>
        </div>
        <div class="book-grid" role="list" data-library-grid></div>
        <template id="book-card-template">
            <article class="book-card" role="listitem" data-book-card>
                <header class="book-card__header">
                    <p class="book-card__lesson" data-field="lesson"></p>
                    <h3 data-field="title"></h3>
                    <p class="book-card__author" data-field="author"></p>
                </header>
                <dl class="book-card__meta">
                    <div>
                        <dt>Format</dt>
                        <dd data-field="format"></dd>
                    </div>
                    <div>
                        <dt>Guild Lore</dt>
                        <dd data-field="lore"></dd>
                    </div>
                </dl>
                <blockquote class="book-card__excerpt" data-field="excerpt"></blockquote>
                <div class="book-card__controls" data-tts-container>
                    <button type="button" class="button" data-tts-action="play">‚ñ∂ Play excerpt</button>
                    <button type="button" class="button button--ghost" data-tts-action="pause" disabled>‚è∏ Pause narration</button>
                </div>
                <div class="book-card__actions">
                    <a class="button" data-action="download" download>‚¨á Download text</a>
                    <a class="button button--ghost" data-action="read" target="_blank" rel="noopener">üìñ Read locally</a>
                </div>
            </article>
        </template>
    </section>

    <section class="notes-panel" aria-labelledby="notes-heading">
        <div class="notes-panel__intro">
            <h2 id="notes-heading">My Notes</h2>
            <p>Collect personal reflections, guild prompts, and study breadcrumbs. Organize them into folders that travel with you across every library room.</p>
        </div>
        <div class="notes-panel__layout">
            <aside class="notes-panel__column">
                <h3>Folders</h3>
                <p data-folder-empty>Begin by creating a folder for your reflections.</p>
                <ul class="notes-panel__folder-list" data-note-folders></ul>
                <form class="notes-panel__form" data-folder-form>
                    <label for="folder-name">New folder</label>
                    <input id="folder-name" name="folder-name" type="text" placeholder="e.g. Comparative Sutras" data-folder-input autocomplete="off">
                    <button type="submit" class="button">Create Folder</button>
                </form>
            </aside>
            <div class="notes-panel__column notes-panel__column--wide" style="gap: 1.6rem;">
                <div class="notes-panel__column" style="background: transparent; border: 1px solid rgba(255, 219, 144, 0.28);">
                    <div>
                        <h3>Notes</h3>
                        <p data-active-folder-label>Select a folder to view its notes.</p>
                    </div>
                    <span class="notes-panel__notes-meta" data-note-count>0 entries</span>
                    <ul class="notes-panel__note-list" data-note-list></ul>
                    <p class="notes-panel__empty" data-note-empty hidden>No notes yet. Add a new note below to begin.</p>
                </div>
                <form class="notes-panel__form" data-note-form>
                    <label for="note-title">Note title</label>
                    <input id="note-title" name="note-title" type="text" placeholder="e.g. Dharma Reflections" data-note-title autocomplete="off">
                    <label for="note-content">Note content</label>
                    <textarea id="note-content" name="note-content" placeholder="Capture quotes, questions, and personal observations." data-note-content></textarea>
                    <button type="submit" class="button">Save Note</button>
                </form>
                <article class="notes-panel__viewer" data-note-viewer hidden>
                    <header>
                        <h3 data-viewer-title></h3>
                        <time data-viewer-date></time>
                    </header>
                    <div class="notes-panel__viewer-content" data-viewer-body></div>
                </article>
                <p class="notes-panel__empty" data-viewer-empty>Select a note to read its contents.</p>
            </div>
        </div>
    </section>

    <section class="tts-evaluation" aria-labelledby="tts-eval-heading">
        <h2 id="tts-eval-heading">Voice Invocation Assessment</h2>
        <p>The guild tested the browser-native <strong>Web Speech API</strong> because it requires no external services, keeps sacred texts offline, and respects our moneyless charter. Modern Chromium, Firefox, and Safari builds expose speech synthesis voices without additional dependencies, though mobile Safari presently limits background playback. The controls above lean on this API to offer immediate play and pause support per excerpt; if a visitor‚Äôs browser lacks the feature, the buttons announce that speech is unavailable and fall back to silent reading.</p>
    </section>

    <section class="tracks">
        <h2>Guild Learning Tracks</h2>
        <div class="tracks-grid">
            <div class="track-card">
                <strong>Beginner</strong>
                <p>Introduction to Eastern Philosophy ‚Äî eight gentle lessons with group check-ins.</p>
            </div>
            <div class="track-card">
                <strong>Intermediate</strong>
                <p>Deep Dive into Sacred Texts ‚Äî twelve-week seminar alternating study and practice labs.</p>
            </div>
            <div class="track-card">
                <strong>Advanced</strong>
                <p>Comparative Analysis &amp; Practice ‚Äî fifteen sessions ending with a community-led symposium.</p>
            </div>
        </div>
    </section>

    <section class="tracks" aria-labelledby="open-sources">
        <h2 id="open-sources">Open-Source Book Notes</h2>
        <p style="margin-bottom: 1.4rem; opacity: 0.85;">Every text in the stacks should come from a repository that welcomes sharing. These are the collections we have verified so far, along with reminders of the licenses that keep them freely distributable.</p>
        <div class="tracks-grid">
            <div class="track-card">
                <strong>Standard Ebooks</strong>
                <p>Curated public-domain classics with clean EPUB/Kindle builds. Licensed CC0 ‚Äî we can mirror releases and note upstream contributors when we prepare our pull requests.</p>
            </div>
            <div class="track-card">
                <strong>Internet Archive ‚Äì Open Library</strong>
                <p>Digital lending plus a public-domain collection. When selecting titles, confirm the "Public Domain" badge or CC license to ensure redistribution fits our commons.</p>
            </div>
            <div class="track-card">
                <strong>Project Gutenberg</strong>
                <p>Over 70,000 volunteer-produced ebooks. Mark specific titles for ingestion and keep the mirror scripts handy for a future automation pull request.</p>
            </div>
            <div class="track-card">
                <strong>Wikimedia Source Texts</strong>
                <p>Translations and commentaries hosted on Wikisource/Wikibooks under CC BY-SA. Track attribution requirements in our notes before we store excerpts.</p>
            </div>
        </div>
        <p style="margin-top: 1.6rem; font-size: 0.95rem; opacity: 0.75;">Next action: create ingestion scripts and citation templates, then open a pull request to add the first mirrored editions with proper metadata.</p>
    </section>

    <nav class="guild-nav" aria-label="Guild ranks of the Order">
        <p class="guild-label">Guild Ranks of the Order</p>
        <ul>
            <li><a href="index.html">Outer Court ¬∑ Visitors</a></li>
            <li><a href="sacred-spaces.html">Sanctum of Stillness ¬∑ Sacred Spaces Guild</a></li>
            <li><a href="journeys.html">Hall of Paths ¬∑ Continuance Circle</a></li>
            <li><a href="living-library.html">Archivum Vitae ¬∑ Living Library Guild</a></li>
            <li><a href="local-ai-companion.html">Workshop of Whispering Circuits ¬∑ Companion Artificers</a></li>
            <li><a href="steward-board.html">Council Hearth ¬∑ Steward Board</a></li>
        </ul>
    </nav>

    <footer>
        Future work: digitize more oral histories, add language accessibility layers, and connect track completion with Steward Board missions. ‚ÄúSet your heart upon your work, never on its reward.‚Äù ‚Äî Lord Krishna
    </footer>

    <script>
        (function () {
            const notesStorageKey = 'living-library-notes';
            const initialNotes = {
                folders: [
                    { id: 'illumined-strategy', name: 'Illumined Strategy' }
                ],
                notes: [
                    {
                        id: 'business-quest-dashboard-inspiration',
                        folderId: 'illumined-strategy',
                        title: 'Business Quest Dashboard Inspiration',
                        content: [
                            'Highlights gathered from the Business Quest Dashboard study:',
                            '‚Ä¢ Quest categories: Business Fundamentals, Finance & Accounting, Marketing & Sales, Operations, Leadership & People, Legal & Compliance.',
                            '‚Ä¢ Featured books: The Lean Startup, Zero to One, The E-Myth Revisited, Profit First, and Building a StoryBrand.',
                            '‚Ä¢ Guild channels to revisit: Y Combinator, The Futur, Valuetainment, Minority Mindset, Accounting Stuff, and The Swedish Investor.'
                        ].join('\n'),
                        createdAt: new Date().toISOString()
                    }
                ]
            };

            const folderList = document.querySelector('[data-note-folders]');
            const folderEmpty = document.querySelector('[data-folder-empty]');
            const noteList = document.querySelector('[data-note-list]');
            const noteEmpty = document.querySelector('[data-note-empty]');
            const noteCount = document.querySelector('[data-note-count]');
            const activeFolderLabel = document.querySelector('[data-active-folder-label]');
            const folderForm = document.querySelector('[data-folder-form]');
            const folderInput = document.querySelector('[data-folder-input]');
            const noteForm = document.querySelector('[data-note-form]');
            const noteTitleInput = document.querySelector('[data-note-title]');
            const noteContentInput = document.querySelector('[data-note-content]');
            const noteSubmitButton = noteForm.querySelector('button');
            const viewer = document.querySelector('[data-note-viewer]');
            const viewerTitle = document.querySelector('[data-viewer-title]');
            const viewerDate = document.querySelector('[data-viewer-date]');
            const viewerBody = document.querySelector('[data-viewer-body]');
            const viewerEmpty = document.querySelector('[data-viewer-empty]');
            const catalogGrid = document.querySelector('[data-library-grid]');
            const catalogStatus = document.querySelector('[data-catalog-status]');
            const catalogFilter = document.querySelector('[data-catalog-filter]');
            const catalogSearch = document.querySelector('[data-catalog-search]');
            const bookCardTemplate = document.getElementById('book-card-template');

            function loadNotes() {
                try {
                    const stored = localStorage.getItem(notesStorageKey);
                    if (stored) {
                        const parsed = JSON.parse(stored);
                        if (parsed && Array.isArray(parsed.folders) && Array.isArray(parsed.notes)) {
                            return parsed;
                        }
                    }
                } catch (error) {
                    console.warn('Unable to parse stored notes', error);
                }
                return initialNotes;
            }

            function persist() {
                localStorage.setItem(notesStorageKey, JSON.stringify(notesState));
            }

            let notesState = loadNotes();
            let activeFolderId = notesState.folders[0] ? notesState.folders[0].id : '';
            let activeNoteId = notesState.notes.find((note) => note.folderId === activeFolderId)?.id || '';

            if (!localStorage.getItem(notesStorageKey)) {
                persist();
            }

            function updateFolderMessage() {
                folderEmpty.hidden = notesState.folders.length > 0;
            }

            function renderFolders() {
                folderList.innerHTML = '';
                notesState.folders.forEach((folder) => {
                    const item = document.createElement('li');
                    const button = document.createElement('button');
                    button.type = 'button';
                    button.className = 'notes-panel__button' + (folder.id === activeFolderId ? ' is-active' : '');
                    button.textContent = folder.name;
                    button.addEventListener('click', () => {
                        activeFolderId = folder.id;
                        activeNoteId = notesState.notes.find((note) => note.folderId === activeFolderId)?.id || '';
                        render();
                    });
                    item.appendChild(button);
                    folderList.appendChild(item);
                });
                updateFolderMessage();
            }

            function renderNotes() {
                noteList.innerHTML = '';
                const folderNotes = activeFolderId
                    ? notesState.notes.filter((note) => note.folderId === activeFolderId)
                    : [];

                noteCount.textContent = `${folderNotes.length} ${folderNotes.length === 1 ? 'entry' : 'entries'}`;

                if (!activeFolderId) {
                    activeFolderLabel.textContent = 'Create a folder to view and store notes.';
                } else {
                    const activeFolder = notesState.folders.find((folder) => folder.id === activeFolderId);
                    activeFolderLabel.textContent = activeFolder
                        ? `Viewing notes in ‚Äú${activeFolder.name}‚Äù`
                        : 'Select a folder to see its notes.';
                }

                if (folderNotes.length === 0) {
                    noteEmpty.hidden = false;
                } else {
                    noteEmpty.hidden = true;
                }

                folderNotes.forEach((note) => {
                    const item = document.createElement('li');
                    const button = document.createElement('button');
                    button.type = 'button';
                    button.className = 'notes-panel__button' + (note.id === activeNoteId ? ' is-active' : '');
                    const titleSpan = document.createElement('span');
                    titleSpan.textContent = note.title;
                    const dateSpan = document.createElement('span');
                    dateSpan.style.fontSize = '0.75rem';
                    dateSpan.style.opacity = '0.75';
                    dateSpan.textContent = new Date(note.createdAt).toLocaleDateString();
                    button.appendChild(titleSpan);
                    button.appendChild(dateSpan);
                    button.addEventListener('click', () => {
                        activeNoteId = note.id;
                        renderViewer();
                        renderNotes();
                    });
                    item.appendChild(button);
                    noteList.appendChild(item);
                });
            }

            function renderViewer() {
                const activeNote = notesState.notes.find((note) => note.id === activeNoteId);
                if (!activeNote) {
                    viewer.hidden = true;
                    viewerEmpty.hidden = false;
                    return;
                }
                viewerTitle.textContent = activeNote.title;
                viewerDate.textContent = new Date(activeNote.createdAt).toLocaleDateString(undefined, {
                    year: 'numeric',
                    month: 'long',
                    day: 'numeric'
                });
                viewerBody.textContent = activeNote.content;
                viewer.hidden = false;
                viewerEmpty.hidden = true;
            }

            function toggleNoteInputs() {
                const disabled = !activeFolderId;
                noteTitleInput.disabled = disabled;
                noteContentInput.disabled = disabled;
                noteSubmitButton.disabled = disabled;
                if (disabled) {
                    noteTitleInput.placeholder = 'Create or select a folder to begin.';
                    noteContentInput.placeholder = 'Create a folder to capture your reflections.';
                } else {
                    noteTitleInput.placeholder = 'e.g. Dharma Reflections';
                    noteContentInput.placeholder = 'Capture quotes, questions, and personal observations.';
                }
            }

            function render() {
                renderFolders();
                renderNotes();
                renderViewer();
                toggleNoteInputs();
            }

            render();

            folderForm.addEventListener('submit', (event) => {
                event.preventDefault();
                const name = folderInput.value.trim();
                if (!name) return;
                const newFolder = { id: `folder-${Date.now()}`, name };
                notesState = {
                    folders: [...notesState.folders, newFolder],
                    notes: notesState.notes
                };
                activeFolderId = newFolder.id;
                activeNoteId = notesState.notes.find((note) => note.folderId === activeFolderId)?.id || '';
                folderInput.value = '';
                persist();
                render();
            });

            noteForm.addEventListener('submit', (event) => {
                event.preventDefault();
                if (!activeFolderId) return;
                const title = noteTitleInput.value.trim();
                const content = noteContentInput.value.trim();
                if (!title || !content) return;
                const newNote = {
                    id: `note-${Date.now()}`,
                    folderId: activeFolderId,
                    title,
                    content,
                    createdAt: new Date().toISOString()
                };
                notesState = {
                    folders: notesState.folders,
                    notes: [newNote, ...notesState.notes]
                };
                noteTitleInput.value = '';
                noteContentInput.value = '';
                activeNoteId = newNote.id;
                persist();
                render();
            });

            let catalogBooks = [];

            function renderCatalogMessage(text, tone = 'empty') {
                if (!catalogGrid) return;
                catalogGrid.innerHTML = '';
                const message = document.createElement('p');
                message.className = tone === 'error' ? 'book-grid__error' : 'book-grid__empty';
                message.textContent = text;
                catalogGrid.appendChild(message);
            }

            function populateCatalogFilters() {
                if (!catalogFilter) return;
                const previous = catalogFilter.value;
                catalogFilter.innerHTML = '';
                const defaultOption = document.createElement('option');
                defaultOption.value = 'all';
                defaultOption.textContent = 'All lessons';
                catalogFilter.appendChild(defaultOption);

                const lessons = new Set();
                catalogBooks
                    .filter((book) => !book.status || book.status === 'active')
                    .forEach((book) => lessons.add(book.sectLesson || 'Unassigned Lesson'));

                Array.from(lessons)
                    .sort((a, b) => a.localeCompare(b))
                    .forEach((lesson) => {
                        const option = document.createElement('option');
                        option.value = lesson;
                        option.textContent = lesson;
                        catalogFilter.appendChild(option);
                    });

                if (previous && lessons.has(previous)) {
                    catalogFilter.value = previous;
                } else {
                    catalogFilter.value = 'all';
                }
            }

            function getVisibleBooks() {
                const filterValue = catalogFilter ? catalogFilter.value : 'all';
                const searchValue = catalogSearch ? catalogSearch.value.trim().toLowerCase() : '';
                return catalogBooks
                    .filter((book) => !book.status || book.status === 'active')
                    .filter((book) => (filterValue === 'all' ? true : (book.sectLesson || 'Unassigned Lesson') === filterValue))
                    .filter((book) => {
                        if (!searchValue) return true;
                        const haystack = [book.title, book.author, book.lore, book.sectLesson]
                            .filter(Boolean)
                            .join(' ')
                            .toLowerCase();
                        return haystack.includes(searchValue);
                    });
            }

            function renderCatalog() {
                if (!catalogGrid || !bookCardTemplate) return;
                const visibleBooks = getVisibleBooks();
                catalogGrid.innerHTML = '';

                if (visibleBooks.length === 0) {
                    if (catalogBooks.length === 0) {
                        renderCatalogMessage('Catalog is awaiting steward uploads.');
                        if (catalogStatus) catalogStatus.textContent = '';
                    } else {
                        renderCatalogMessage('No books match the current filters.');
                        if (catalogStatus) catalogStatus.textContent = '';
                    }
                    setupSpeechSynthesis();
                    return;
                }

                const fragment = document.createDocumentFragment();
                visibleBooks.forEach((book, index) => {
                    const clone = bookCardTemplate.content.cloneNode(true);
                    const card = clone.querySelector('[data-book-card]');
                    if (!card) {
                        return;
                    }

                    const lessonField = card.querySelector('[data-field="lesson"]');
                    const titleField = card.querySelector('[data-field="title"]');
                    const authorField = card.querySelector('[data-field="author"]');
                    const formatField = card.querySelector('[data-field="format"]');
                    const loreField = card.querySelector('[data-field="lore"]');
                    const excerptField = card.querySelector('[data-field="excerpt"]');
                    const downloadLink = card.querySelector('[data-action="download"]');
                    const readLink = card.querySelector('[data-action="read"]');
                    const controls = card.querySelector('[data-tts-container]');

                    if (lessonField) lessonField.textContent = book.sectLesson || 'Unassigned Lesson';
                    if (titleField) titleField.textContent = book.title || 'Untitled Manuscript';
                    if (authorField) authorField.textContent = book.author || 'Unknown Author';
                    if (formatField) formatField.textContent = book.formatNotes || 'Awaiting steward review.';
                    if (loreField) loreField.textContent = book.lore || 'Awaiting lore steward annotation.';
                    if (excerptField) {
                        excerptField.textContent = book.excerpt || 'Excerpt pending steward review.';
                        const excerptId = `catalog-excerpt-${book.id || index}`;
                        excerptField.id = excerptId;
                        if (controls) {
                            controls.setAttribute('data-tts-target', excerptId);
                            controls.setAttribute('data-tts-lang', book.ttsLang || 'en-US');
                        }
                    }

                    if (downloadLink) {
                        if (book.file) {
                            downloadLink.href = book.file;
                            downloadLink.removeAttribute('aria-disabled');
                        } else {
                            downloadLink.removeAttribute('href');
                            downloadLink.setAttribute('aria-disabled', 'true');
                            downloadLink.textContent = 'Unavailable';
                        }
                    }

                    if (readLink) {
                        if (book.file) {
                            readLink.href = book.file;
                        } else {
                            readLink.removeAttribute('href');
                            readLink.setAttribute('aria-disabled', 'true');
                            readLink.textContent = 'Unavailable';
                        }
                    }

                    fragment.appendChild(clone);
                });

                catalogGrid.appendChild(fragment);
                if (catalogStatus) {
                    catalogStatus.textContent = `${visibleBooks.length} of ${catalogBooks.length} books visible.`;
                }
                setupSpeechSynthesis();
            }

            async function loadCatalog() {
                if (!catalogStatus) return;
                try {
                    catalogStatus.textContent = 'Loading catalog‚Ä¶';
                    const response = await fetch('/library/catalog');
                    if (!response.ok) {
                        throw new Error(`Unable to load catalog (status ${response.status})`);
                    }
                    const payload = await response.json();
                    if (!payload || !Array.isArray(payload.books)) {
                        throw new Error('Catalog response was malformed.');
                    }
                    catalogBooks = payload.books;
                    populateCatalogFilters();
                    renderCatalog();
                    if (catalogBooks.length === 0) {
                        renderCatalogMessage('Catalog is awaiting steward uploads.');
                        catalogStatus.textContent = '';
                    }
                } catch (error) {
                    const message = error instanceof Error ? error.message : 'Unable to load catalog.';
                    if (catalogStatus) catalogStatus.textContent = message;
                    renderCatalogMessage(message, 'error');
                    setupSpeechSynthesis();
                }
            }

            if (catalogFilter) {
                catalogFilter.addEventListener('change', () => {
                    renderCatalog();
                });
            }

            if (catalogSearch) {
                catalogSearch.addEventListener('input', () => {
                    renderCatalog();
                });
            }

            loadCatalog();

            const supportWarning = 'Speech synthesis is unavailable in this browser.';
            const speech = {
                synthesis: typeof window !== 'undefined' && 'speechSynthesis' in window ? window.speechSynthesis : null,
                currentUtterance: null,
                currentContainer: null
            };

            function resetSpeechButtons(container) {
                const pauseButton = container.querySelector('[data-tts-action="pause"]');
                const playButton = container.querySelector('[data-tts-action="play"]');
                if (pauseButton) pauseButton.disabled = true;
                if (playButton) {
                    playButton.disabled = false;
                    playButton.textContent = '‚ñ∂ Play excerpt';
                }
            }

            function announceSpeechState(container, state) {
                container.setAttribute('data-tts-status', state);
            }

            function disableSpeechControls() {
                const containers = document.querySelectorAll('[data-tts-container]');
                containers.forEach((container) => {
                    container.querySelectorAll('button').forEach((button) => {
                        button.disabled = true;
                        button.setAttribute('aria-disabled', 'true');
                        button.title = supportWarning;
                        button.textContent = 'Speech unavailable';
                    });
                });
            }

            function attachSpeechControls() {
                const containers = Array.from(document.querySelectorAll('[data-tts-container]'));
                containers.forEach((container) => {
                    const targetId = container.getAttribute('data-tts-target');
                    const excerpt = targetId ? document.getElementById(targetId) : null;
                    const playButton = container.querySelector('[data-tts-action="play"]');
                    const pauseButton = container.querySelector('[data-tts-action="pause"]');
                    if (!excerpt || !playButton || !pauseButton) {
                        return;
                    }

                    const text = excerpt.textContent.trim();
                    const lang = container.getAttribute('data-tts-lang') || 'en-US';
                    pauseButton.disabled = true;

                    if (!text) {
                        playButton.disabled = true;
                        pauseButton.disabled = true;
                        playButton.textContent = 'No excerpt';
                        return;
                    }

                    playButton.addEventListener('click', () => {
                        if (speech.currentContainer === container && speech.synthesis && speech.synthesis.paused) {
                            speech.synthesis.resume();
                            pauseButton.disabled = false;
                            playButton.textContent = '‚ñ∂ Playing‚Ä¶';
                            announceSpeechState(container, 'playing');
                            return;
                        }

                        if (speech.synthesis && speech.synthesis.speaking) {
                            speech.synthesis.cancel();
                        }

                        if (!speech.synthesis) {
                            return;
                        }

                        const utterance = new SpeechSynthesisUtterance(text);
                        utterance.lang = lang;
                        utterance.onend = utterance.onerror = () => {
                            resetSpeechButtons(container);
                            announceSpeechState(container, 'idle');
                            speech.currentContainer = null;
                            speech.currentUtterance = null;
                        };

                        containers.forEach((other) => {
                            if (other !== container) {
                                resetSpeechButtons(other);
                                announceSpeechState(other, 'idle');
                            }
                        });

                        pauseButton.disabled = false;
                        playButton.textContent = '‚ñ∂ Playing‚Ä¶';
                        announceSpeechState(container, 'playing');
                        speech.currentContainer = container;
                        speech.currentUtterance = utterance;
                        speech.synthesis.speak(utterance);
                    });

                    pauseButton.addEventListener('click', () => {
                        if (!speech.synthesis || speech.currentContainer !== container) {
                            return;
                        }
                        if (speech.synthesis.speaking && !speech.synthesis.paused) {
                            speech.synthesis.pause();
                            pauseButton.disabled = true;
                            playButton.disabled = false;
                            playButton.textContent = '‚ñ∂ Resume excerpt';
                            announceSpeechState(container, 'paused');
                        }
                    });
                });
            }

            function setupSpeechSynthesis() {
                if (!speech.synthesis) {
                    disableSpeechControls();
                    return;
                }
                attachSpeechControls();
            }

            setupSpeechSynthesis();
        })();
    </script>
</body>
</html>
