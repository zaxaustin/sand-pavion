<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sand Pavilion ‚Äî Living Library</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Merriweather', serif;
            background: linear-gradient(160deg, #1b1a24, #402f1d 45%, #c69b58 100%);
            color: #fef6e4;
            min-height: 100vh;
        }
        header {
            text-align: center;
            padding: 3rem 1rem 2rem;
        }
        header h1 { font-size: 3rem; margin-bottom: 0.6rem; letter-spacing: 0.06em; }
        header p { max-width: 760px; margin: 0 auto; font-size: 1.05rem; opacity: 0.85; }
        .blessing-banner {
            margin: 1.6rem auto 0;
            padding: 1rem 1.2rem;
            max-width: 760px;
            background: rgba(255, 245, 220, 0.1);
            border-radius: 18px;
            border: 1px solid rgba(255, 219, 144, 0.4);
            display: grid;
            gap: 0.6rem;
            font-size: 0.95rem;
        }
        .blessing-banner span {
            display: flex;
            gap: 0.5rem;
            align-items: center;
            color: #ffe6a7;
        }
        .blessing-banner em {
            font-style: normal;
            opacity: 0.85;
        }
        .shelves {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 1.5rem 3.5rem;
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
            gap: 1.6rem;
        }
        .shelf {
            background: rgba(24, 17, 9, 0.75);
            border-radius: 18px;
            padding: 1.8rem;
            border: 1px solid rgba(255, 219, 144, 0.3);
            box-shadow: 0 18px 40px rgba(0, 0, 0, 0.35);
        }
        .shelf h2 { color: #ffd787; margin-bottom: 0.8rem; font-size: 1.5rem; }
        .shelf ul { list-style: none; }
        .shelf li { margin-bottom: 0.6rem; }
        .library-holdings {
            max-width: 1200px;
            margin: 0 auto 3rem;
            padding: 0 1.5rem;
        }
        .library-holdings__header {
            text-align: center;
            margin-bottom: 2rem;
        }
        .library-holdings__header h2 {
            color: #ffe6a7;
            font-size: 2.2rem;
            margin-bottom: 0.8rem;
        }
        .library-holdings__header p {
            max-width: 860px;
            margin: 0 auto;
            line-height: 1.6;
            opacity: 0.9;
        }
        .catalog-controls {
            display: flex;
            flex-direction: column;
            gap: 1rem;
            margin-bottom: 1.5rem;
        }
        .catalog-controls__filters {
            display: flex;
            flex-wrap: wrap;
            gap: 0.8rem;
        }
        .catalog-controls__filters label,
        .catalog-controls__filters .catalog-controls__search {
            display: inline-flex;
            align-items: center;
            gap: 0.6rem;
            background: rgba(255, 255, 255, 0.08);
            border: 1px solid rgba(255, 219, 144, 0.4);
            border-radius: 16px;
            padding: 0.55rem 0.8rem;
        }
        .catalog-controls__filters select,
        .catalog-controls__filters input {
            background: transparent;
            border: none;
            color: #ffe6a7;
            font-weight: 600;
            font-size: 0.9rem;
            outline: none;
        }
        .catalog-controls__filters option {
            color: #1b1a24;
        }
        .catalog-controls__filters input::placeholder {
            color: rgba(255, 230, 167, 0.6);
        }
        .catalog-controls__status {
            font-size: 0.85rem;
            color: rgba(255, 230, 167, 0.8);
        }
        .book-grid {
            display: grid;
            gap: 1.8rem;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
        }
        .book-grid__empty,
        .book-grid__error {
            grid-column: 1 / -1;
            padding: 1.6rem;
            border-radius: 18px;
            border: 1px dashed rgba(255, 219, 144, 0.45);
            background: rgba(24, 17, 9, 0.55);
            text-align: center;
            line-height: 1.6;
            color: rgba(255, 230, 167, 0.85);
        }
        .book-card {
            background: rgba(24, 17, 9, 0.85);
            border-radius: 22px;
            padding: 1.8rem;
            border: 1px solid rgba(255, 219, 144, 0.35);
            display: flex;
            flex-direction: column;
            gap: 1.2rem;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.4);
        }
        .book-card__header h3 {
            font-size: 1.6rem;
            color: #ffd787;
            margin-bottom: 0.4rem;
        }
        .book-card__lesson {
            font-size: 0.85rem;
            letter-spacing: 0.08em;
            text-transform: uppercase;
            color: rgba(255, 230, 167, 0.8);
        }
        .book-card__author {
            font-size: 1rem;
            color: rgba(255, 230, 167, 0.9);
        }
        .book-card__meta {
            display: grid;
            gap: 0.6rem;
        }
        .book-card__meta div {
            background: rgba(255, 255, 255, 0.05);
            padding: 0.8rem;
            border-radius: 12px;
        }
        .book-card__meta dt {
            font-size: 0.75rem;
            text-transform: uppercase;
            letter-spacing: 0.06em;
            color: rgba(255, 230, 167, 0.6);
            margin-bottom: 0.25rem;
        }
        .book-card__meta dd {
            margin: 0;
            line-height: 1.5;
        }
        .book-card__excerpt {
            font-size: 0.95rem;
            line-height: 1.7;
            color: rgba(255, 246, 228, 0.92);
            background: rgba(0, 0, 0, 0.25);
            border-left: 3px solid rgba(255, 219, 144, 0.7);
            padding: 1rem 1.2rem;
            border-radius: 16px;
        }
        .book-card__controls,
        .book-card__actions {
            display: flex;
            flex-wrap: wrap;
            gap: 0.6rem;
        }
        .button {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 0.4rem;
            background: rgba(255, 219, 144, 0.28);
            color: #1b1a24;
            padding: 0.55rem 1.1rem;
            border-radius: 999px;
            border: 1px solid rgba(255, 219, 144, 0.6);
            font-weight: 600;
            font-size: 0.9rem;
            cursor: pointer;
            text-decoration: none;
            transition: background 0.3s ease, transform 0.2s ease;
        }
        .button:hover,
        .button:focus {
            background: rgba(255, 219, 144, 0.45);
            transform: translateY(-1px);
            outline: none;
        }
        .button:disabled,
        .button[aria-disabled="true"] {
            cursor: not-allowed;
            opacity: 0.6;
            background: rgba(255, 255, 255, 0.12);
            color: rgba(255, 246, 228, 0.6);
        }
        .button--ghost {
            background: transparent;
            color: #ffe6a7;
            border-color: rgba(255, 230, 167, 0.5);
        }
        .button--ghost:hover,
        .button--ghost:focus {
            background: rgba(255, 230, 167, 0.18);
            color: #1b1a24;
        }
        .notes-panel {
            margin: 3rem auto;
            max-width: 1100px;
            padding: 2.4rem;
            border-radius: 24px;
            border: 1px solid rgba(255, 219, 144, 0.35);
            background: rgba(24, 17, 9, 0.82);
            box-shadow: 0 24px 48px rgba(0, 0, 0, 0.35);
            display: grid;
            gap: 2rem;
        }
        .notes-panel__intro h2 {
            font-size: 2.2rem;
            color: #ffe6a7;
            margin-bottom: 0.6rem;
        }
        .notes-panel__intro p {
            opacity: 0.85;
            line-height: 1.6;
        }
        .notes-panel__layout {
            display: grid;
            gap: 1.6rem;
            grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
        }
        .notes-panel__column {
            background: rgba(0, 0, 0, 0.35);
            border-radius: 18px;
            border: 1px solid rgba(255, 219, 144, 0.25);
            padding: 1.6rem;
            display: grid;
            gap: 1.2rem;
            align-content: start;
        }
        .notes-panel__column--wide {
            background: none;
            border: none;
            padding: 0;
        }
        .notes-panel__column h3 {
            display: flex;
            align-items: center;
            gap: 0.6rem;
            color: #ffd787;
            font-size: 1.2rem;
        }
        .notes-panel__identity {
            margin-bottom: 1.4rem;
            padding: 1.2rem;
            border-radius: 16px;
            border: 1px solid rgba(255, 219, 144, 0.3);
            background: rgba(0, 0, 0, 0.4);
        }
        .notes-panel__identity-id {
            margin-top: 0.6rem;
            font-size: 0.85rem;
            opacity: 0.85;
        }
        .notes-panel__column p {
            font-size: 0.9rem;
            color: rgba(255, 230, 167, 0.78);
        }
        .notes-panel__folder-list,
        .notes-panel__note-list {
            list-style: none;
            margin: 0;
            padding: 0;
            display: grid;
            gap: 0.6rem;
        }
        .notes-panel__button {
            width: 100%;
            padding: 0.65rem 0.9rem;
            border-radius: 14px;
            border: 1px solid transparent;
            background: rgba(255, 219, 144, 0.12);
            color: #ffe6a7;
            font-weight: 600;
            font-size: 0.92rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 0.6rem;
            cursor: pointer;
            transition: background 0.25s ease, border 0.25s ease, transform 0.2s ease;
        }
        .notes-panel__button:hover,
        .notes-panel__button:focus {
            background: rgba(255, 219, 144, 0.22);
            border-color: rgba(255, 219, 144, 0.35);
            outline: none;
            transform: translateY(-1px);
        }
        .notes-panel__button.is-active {
            background: rgba(255, 219, 144, 0.32);
            border-color: rgba(255, 219, 144, 0.6);
            color: #1b1a24;
        }
        .notes-panel__form {
            background: rgba(255, 219, 144, 0.12);
            border-radius: 16px;
            border: 1px solid rgba(255, 219, 144, 0.25);
            padding: 1.2rem;
            display: grid;
            gap: 0.8rem;
        }
        .notes-panel__form label {
            font-size: 0.85rem;
            letter-spacing: 0.05em;
            text-transform: uppercase;
            color: rgba(255, 230, 167, 0.85);
        }
        .notes-panel__form input,
        .notes-panel__form textarea,
        .notes-panel__form select {
            width: 100%;
            border-radius: 12px;
            border: 1px solid rgba(255, 219, 144, 0.4);
            background: rgba(0, 0, 0, 0.25);
            padding: 0.75rem 0.9rem;
            color: #ffe6a7;
            font-family: inherit;
            font-size: 0.95rem;
            transition: border 0.2s ease, background 0.2s ease;
        }
        .notes-panel__form input:focus,
        .notes-panel__form textarea:focus,
        .notes-panel__form select:focus {
            border-color: rgba(255, 219, 144, 0.65);
            background: rgba(0, 0, 0, 0.35);
            outline: none;
        }
        .notes-panel__form textarea {
            min-height: 140px;
            resize: vertical;
        }
        .notes-panel__form button {
            justify-self: start;
        }
        .notes-panel__notes-meta {
            font-size: 0.85rem;
            opacity: 0.75;
            letter-spacing: 0.05em;
            text-transform: uppercase;
        }
        .notes-panel__viewer {
            background: rgba(0, 0, 0, 0.35);
            border-radius: 18px;
            border: 1px solid rgba(255, 219, 144, 0.25);
            padding: 1.6rem;
            display: grid;
            gap: 0.8rem;
        }
        .notes-panel__viewer h3 {
            color: #ffd787;
            font-size: 1.6rem;
        }
        .notes-panel__viewer time {
            font-size: 0.85rem;
            letter-spacing: 0.06em;
            text-transform: uppercase;
            color: rgba(255, 230, 167, 0.65);
        }
        .notes-panel__viewer-content {
            background: rgba(0, 0, 0, 0.28);
            border-radius: 16px;
            border: 1px solid rgba(255, 219, 144, 0.22);
            padding: 1.2rem;
            line-height: 1.7;
            color: rgba(255, 246, 228, 0.92);
            white-space: pre-wrap;
        }
        .notes-panel__empty {
            border: 1px dashed rgba(255, 219, 144, 0.35);
            border-radius: 16px;
            padding: 1.4rem;
            text-align: center;
            color: rgba(255, 230, 167, 0.72);
            font-size: 0.95rem;
        }
        .notes-panel__identity {
            margin-bottom: 1.4rem;
            padding: 1.2rem;
            border-radius: 16px;
            border: 1px solid rgba(255, 219, 144, 0.28);
            background: rgba(0, 0, 0, 0.4);
        }
        .notes-panel__identity-id {
            margin-top: 0.6rem;
            font-size: 0.85rem;
            opacity: 0.85;
        }
        .notes-panel__sync {
            font-size: 0.8rem;
            margin: 0.2rem 0 0.8rem;
            color: rgba(255, 230, 167, 0.8);
        }
        .notes-panel__sync[data-tone="warning"] {
            color: #ffd48c;
        }
        .notes-panel__sync[data-tone="error"] {
            color: #ff9f9f;
        }
        .notes-panel__sync[data-tone="success"] {
            color: #b4ffd5;
        }
        .notes-panel__viewer-meta {
            font-size: 0.85rem;
            color: rgba(255, 230, 167, 0.8);
        }
        .notes-panel__alert {
            font-size: 0.9rem;
            margin-top: 0.8rem;
            padding: 0.6rem 0.8rem;
            border-radius: 14px;
            border: 1px solid rgba(255, 219, 144, 0.35);
            background: rgba(0, 0, 0, 0.45);
        }
        .notes-panel__alert[data-tone="error"] {
            border-color: rgba(255, 107, 129, 0.7);
            color: #ffb0b0;
        }
        .notes-panel__alert[data-tone="success"] {
            border-color: rgba(126, 255, 189, 0.6);
            color: #c5ffe2;
        }
        .notes-panel__alert[data-tone="warning"] {
            border-color: rgba(255, 219, 144, 0.6);
            color: #ffe6b5;
        }
        .notes-panel__badge {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            padding: 0.1rem 0.55rem;
            border-radius: 999px;
            border: 1px solid rgba(255, 219, 144, 0.4);
            font-size: 0.75rem;
            letter-spacing: 0.05em;
            text-transform: uppercase;
        }
        .tts-evaluation {
            max-width: 960px;
            margin: 0 auto 3rem;
            padding: 0 1.5rem;
            text-align: center;
        }
        .tts-evaluation h2 {
            color: #ffe6a7;
            font-size: 1.9rem;
            margin-bottom: 1rem;
        }
        .tts-evaluation p {
            line-height: 1.7;
            opacity: 0.85;
        }
        .tracks {
            background: rgba(255, 255, 255, 0.08);
            border-radius: 18px;
            max-width: 1000px;
            margin: 0 auto 3rem;
            padding: 2rem;
            text-align: center;
        }
        .tracks h2 { color: #ffe6a7; font-size: 2rem; margin-bottom: 1rem; }
        .tracks-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
            gap: 1.2rem;
        }
        .track-card {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 16px;
            padding: 1.4rem;
            border: 1px solid rgba(255, 219, 144, 0.2);
        }
        footer { text-align: center; padding: 2rem 1rem 3rem; font-size: 0.9rem; opacity: 0.75; }
        a.back { color: #ffd787; text-decoration: none; font-weight: bold; letter-spacing: 0.05em; display: inline-block; margin-top: 1.5rem; }
        a.back:hover { text-decoration: underline; }
        .guild-nav {
            margin: 3rem auto 0;
            max-width: 900px;
            padding: 1.2rem 1.5rem;
            border-radius: 18px;
            background: rgba(27, 26, 36, 0.85);
            border: 1px solid rgba(255, 219, 144, 0.35);
            display: grid;
            gap: 0.8rem;
        }
        .guild-label {
            text-transform: uppercase;
            letter-spacing: 0.08em;
            font-size: 0.75rem;
            color: #ffe6a7;
            text-align: center;
        }
        .guild-nav ul {
            list-style: none;
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
            gap: 0.8rem;
            padding: 0;
            margin: 0;
        }
        .guild-nav a {
            display: block;
            text-decoration: none;
            font-weight: 600;
            font-size: 0.85rem;
            color: #ffe6a7;
            padding: 0.6rem 0.8rem;
            border-radius: 14px;
            background: rgba(255, 219, 144, 0.18);
            text-align: center;
            transition: background 0.3s ease, color 0.3s ease;
        }
        .guild-nav a:hover,
        .guild-nav a:focus {
            background: rgba(255, 219, 144, 0.35);
            color: #1b1a24;
        }
    </style>
</head>
<body>
    <header>
        <h1>Archivum Vitae ‚Äî Living Library Guild</h1>
        <p>The Archivum Vitae keeps our references alive. Guild scribes collect sacred texts, oral histories, and modern manuals, pairing each with notes and discussion circles so every initiate can study with guidance.</p>
        <div class="blessing-banner" aria-label="Library blessings">
            <span>‚ú∂ <em>‚ÄúPeace I leave with you; my peace I give you.‚Äù ‚Äî Jesus (John 14:27)</em></span>
            <span>‚ú∂ <em>‚ÄúMay the lamp of knowledge remove the darkness of ignorance.‚Äù ‚Äî Invocation to Saraswati</em></span>
            <span>‚ú∂ <em>‚ÄúAs rain falls equally on the just and unjust, let your heart be impartial.‚Äù ‚Äî The Buddha</em></span>
        </div>
        <a class="back" href="index.html">‚Üê Return to the Pavilion</a>
    </header>

    <section class="shelves" aria-label="Living Library study rooms">
        <article class="shelf">
            <h2>Shelf I ¬∑ Hindu Wisdom Room</h2>
            <ul>
                <li>Bhagavad Gita ‚Äî annotated with line-by-line commentary circles.</li>
                <li>Upanishads ‚Äî audio recitations from multilingual volunteers.</li>
                <li>Vedas ‚Äî curated excerpts focused on ritual, cosmology, and ethics.</li>
            </ul>
        </article>
        <article class="shelf">
            <h2>Shelf II ¬∑ Buddhist Insights Room</h2>
            <ul>
                <li>Dhammapada ‚Äî daily verse reflections recorded by community elders.</li>
                <li>Heart Sutra ‚Äî interactive diagrams exploring emptiness teachings.</li>
                <li>Tibetan Book of the Dead ‚Äî peer study group transcripts.</li>
            </ul>
        </article>
        <article class="shelf">
            <h2>Shelf III ¬∑ Comparative Studies Room</h2>
            <ul>
                <li>Perennial Philosophy ‚Äî roundtable discussions and notes.</li>
                <li>World Religions ‚Äî shared timelines mapping cross-tradition echoes.</li>
                <li>Mysticism East &amp; West ‚Äî gallery of key metaphors and practices.</li>
            </ul>
        </article>
        <article class="shelf">
            <h2>Shelf IV ¬∑ Meditation &amp; Practice Room</h2>
            <ul>
                <li>Mindfulness Guide ‚Äî printable practice cards for quick sessions.</li>
                <li>Pranayama Techniques ‚Äî annotated breath sequences with safety cues.</li>
                <li>Zen Practice ‚Äî community podcast with weekly koan reflections.</li>
            </ul>
        </article>
    </section>

    <section class="library-holdings" aria-labelledby="public-domain-holdings">
        <div class="library-holdings__header">
            <h2 id="public-domain-holdings">Mirrored Public-Domain Holdings</h2>
            <p>Guild archivists keep at least three mirrored editions on-site so that every initiate has resilient access to our shared study canon. Each card below names the lineage, shares our lore-friendly study focus, and links to the local copy.</p>
        </div>
        <div class="catalog-controls">
            <div class="catalog-controls__filters">
                <label>
                    <span style="font-weight: 700; font-size: 0.85rem; text-transform: uppercase; letter-spacing: 0.08em;">Lesson</span>
                    <select data-catalog-filter>
                        <option value="all">All lessons</option>
                    </select>
                </label>
                <div class="catalog-controls__search">
                    <span aria-hidden="true">üîç</span>
                    <input type="search" data-catalog-search placeholder="Search title or lore">
                </div>
            </div>
            <p class="catalog-controls__status" data-catalog-status></p>
        </div>
        <div class="book-grid" role="list" data-library-grid></div>
        <template id="book-card-template">
            <article class="book-card" role="listitem" data-book-card>
                <header class="book-card__header">
                    <p class="book-card__lesson" data-field="lesson"></p>
                    <h3 data-field="title"></h3>
                    <p class="book-card__author" data-field="author"></p>
                </header>
                <dl class="book-card__meta">
                    <div>
                        <dt>Format</dt>
                        <dd data-field="format"></dd>
                    </div>
                    <div>
                        <dt>Guild Lore</dt>
                        <dd data-field="lore"></dd>
                    </div>
                </dl>
                <blockquote class="book-card__excerpt" data-field="excerpt"></blockquote>
                <div class="book-card__controls" data-tts-container>
                    <button type="button" class="button" data-tts-action="play">‚ñ∂ Play excerpt</button>
                    <button type="button" class="button button--ghost" data-tts-action="pause" disabled>‚è∏ Pause narration</button>
                </div>
                <div class="book-card__actions">
                    <a class="button" data-action="download" download>‚¨á Download text</a>
                    <a class="button button--ghost" data-action="read" target="_blank" rel="noopener">üìñ Read locally</a>
                </div>
            </article>
        </template>
    </section>

    <section class="notes-panel" aria-labelledby="notes-heading">
        <div class="notes-panel__intro">
            <h2 id="notes-heading">My Notes</h2>
            <p>Collect personal reflections, guild prompts, and study breadcrumbs. Organize them into folders that travel with you across every library room.</p>
        </div>
        <div class="notes-panel__layout">
            <aside class="notes-panel__column">
                <div class="notes-panel__identity">
                    <div>
                        <h3>Steward Handle</h3>
                        <p>Set the name attached to your uploads so the ledger can sync across rooms.</p>
                    </div>
                    <form class="notes-panel__form" data-identity-form>
                        <label for="identity-name">Display name</label>
                        <input id="identity-name" name="identity-name" type="text" placeholder="Outer Court Visitor" data-identity-input autocomplete="off">
                        <button type="submit" class="button">Update Name</button>
                    </form>
                    <p class="notes-panel__identity-id">Shareable ID: <code data-identity-id></code></p>
                </div>
                <h3>Folders</h3>
                <p data-folder-empty>Begin by creating a folder for your reflections.</p>
                <ul class="notes-panel__folder-list" data-note-folders></ul>
                <form class="notes-panel__form" data-folder-form>
                    <label for="folder-name">New folder</label>
                    <input id="folder-name" name="folder-name" type="text" placeholder="e.g. Comparative Sutras" data-folder-input autocomplete="off">
                    <button type="submit" class="button">Create Folder</button>
                </form>
            </aside>
            <div class="notes-panel__column notes-panel__column--wide" style="gap: 1.6rem;">
                <div class="notes-panel__column" style="background: transparent; border: 1px solid rgba(255, 219, 144, 0.28);">
                    <div>
                        <h3>Notes</h3>
                        <p data-active-folder-label>Select a folder to view its notes.</p>
                    </div>
                    <p class="notes-panel__sync" data-note-sync>Connecting to the steward server‚Ä¶</p>
                    <span class="notes-panel__notes-meta" data-note-count>0 entries</span>
                    <ul class="notes-panel__note-list" data-note-list></ul>
                    <p class="notes-panel__empty" data-note-empty hidden>No notes yet. Add a new note below to begin.</p>
                </div>
                <form class="notes-panel__form" data-note-form>
                    <label for="note-title">Note title</label>
                    <input id="note-title" name="note-title" type="text" placeholder="e.g. Dharma Reflections" data-note-title autocomplete="off">
                    <label for="note-content">Note content</label>
                    <textarea id="note-content" name="note-content" placeholder="Capture quotes, questions, and personal observations." data-note-content></textarea>
                    <label for="note-folder">Save to folder</label>
                    <select id="note-folder" name="note-folder" data-note-folder></select>
                    <label for="note-visibility">Visibility</label>
                    <select id="note-visibility" name="note-visibility" data-note-visibility>
                        <option value="private">Private draft</option>
                        <option value="public">Public annotation</option>
                    </select>
                    <button type="submit" class="button">Save Note</button>
                    <p class="notes-panel__alert" data-note-alert hidden></p>
                </form>
                <article class="notes-panel__viewer" data-note-viewer hidden>
                    <header>
                        <h3 data-viewer-title></h3>
                        <time data-viewer-date></time>
                        <p class="notes-panel__viewer-meta" data-viewer-meta></p>
                    </header>
                    <div class="notes-panel__viewer-content" data-viewer-body></div>
                </article>
                <p class="notes-panel__empty" data-viewer-empty>Select a note to read its contents.</p>
            </div>
        </div>
    </section>

    <section class="tts-evaluation" aria-labelledby="tts-eval-heading">
        <h2 id="tts-eval-heading">Voice Invocation Assessment</h2>
        <p>The guild tested the browser-native <strong>Web Speech API</strong> because it requires no external services, keeps sacred texts offline, and respects our moneyless charter. Modern Chromium, Firefox, and Safari builds expose speech synthesis voices without additional dependencies, though mobile Safari presently limits background playback. The controls above lean on this API to offer immediate play and pause support per excerpt; if a visitor‚Äôs browser lacks the feature, the buttons announce that speech is unavailable and fall back to silent reading.</p>
    </section>

    <section class="tracks">
        <h2>Guild Learning Tracks</h2>
        <div class="tracks-grid">
            <div class="track-card">
                <strong>Beginner</strong>
                <p>Introduction to Eastern Philosophy ‚Äî eight gentle lessons with group check-ins.</p>
            </div>
            <div class="track-card">
                <strong>Intermediate</strong>
                <p>Deep Dive into Sacred Texts ‚Äî twelve-week seminar alternating study and practice labs.</p>
            </div>
            <div class="track-card">
                <strong>Advanced</strong>
                <p>Comparative Analysis &amp; Practice ‚Äî fifteen sessions ending with a community-led symposium.</p>
            </div>
        </div>
    </section>

    <section class="tracks" aria-labelledby="open-sources">
        <h2 id="open-sources">Open-Source Book Notes</h2>
        <p style="margin-bottom: 1.4rem; opacity: 0.85;">Every text in the stacks should come from a repository that welcomes sharing. These are the collections we have verified so far, along with reminders of the licenses that keep them freely distributable.</p>
        <div class="tracks-grid">
            <div class="track-card">
                <strong>Standard Ebooks</strong>
                <p>Curated public-domain classics with clean EPUB/Kindle builds. Licensed CC0 ‚Äî we can mirror releases and note upstream contributors when we prepare our pull requests.</p>
            </div>
            <div class="track-card">
                <strong>Internet Archive ‚Äì Open Library</strong>
                <p>Digital lending plus a public-domain collection. When selecting titles, confirm the "Public Domain" badge or CC license to ensure redistribution fits our commons.</p>
            </div>
            <div class="track-card">
                <strong>Project Gutenberg</strong>
                <p>Over 70,000 volunteer-produced ebooks. Mark specific titles for ingestion and keep the mirror scripts handy for a future automation pull request.</p>
            </div>
            <div class="track-card">
                <strong>Wikimedia Source Texts</strong>
                <p>Translations and commentaries hosted on Wikisource/Wikibooks under CC BY-SA. Track attribution requirements in our notes before we store excerpts.</p>
            </div>
        </div>
        <p style="margin-top: 1.6rem; font-size: 0.95rem; opacity: 0.75;">Next action: create ingestion scripts and citation templates, then open a pull request to add the first mirrored editions with proper metadata.</p>
    </section>

    <nav class="guild-nav" aria-label="Guild ranks of the Order">
        <p class="guild-label">Guild Ranks of the Order</p>
        <ul>
            <li><a href="index.html">Outer Court ¬∑ Visitors</a></li>
            <li><a href="sacred-spaces.html">Sanctum of Stillness ¬∑ Sacred Spaces Guild</a></li>
            <li><a href="journeys.html">Hall of Paths ¬∑ Continuance Circle</a></li>
            <li><a href="living-library.html">Archivum Vitae ¬∑ Living Library Guild</a></li>
            <li><a href="local-ai-companion.html">Workshop of Whispering Circuits ¬∑ Companion Artificers</a></li>
            <li><a href="steward-board.html">Council Hearth ¬∑ Steward Board</a></li>
        </ul>
    </nav>

    <footer>
        Future work: digitize more oral histories, add language accessibility layers, and connect track completion with Steward Board missions. ‚ÄúSet your heart upon your work, never on its reward.‚Äù ‚Äî Lord Krishna
    </footer>

    
    <script>
        (function () {
            const API_BASE = '';
            const identityKey = 'living-library-identity';
            const cachePrefix = 'living-library-notes-cache';
            const defaultDisplayName = 'Outer Court Visitor';

            const elements = {
                folderList: document.querySelector('[data-note-folders]'),
                folderEmpty: document.querySelector('[data-folder-empty]'),
                folderForm: document.querySelector('[data-folder-form]'),
                folderInput: document.querySelector('[data-folder-input]'),
                noteList: document.querySelector('[data-note-list]'),
                noteEmpty: document.querySelector('[data-note-empty]'),
                noteForm: document.querySelector('[data-note-form]'),
                noteTitle: document.querySelector('[data-note-title]'),
                noteContent: document.querySelector('[data-note-content]'),
                noteCount: document.querySelector('[data-note-count]'),
                activeFolderLabel: document.querySelector('[data-active-folder-label]'),
                noteViewer: document.querySelector('[data-note-viewer]'),
                viewerEmpty: document.querySelector('[data-viewer-empty]'),
                viewerTitle: document.querySelector('[data-viewer-title]'),
                viewerDate: document.querySelector('[data-viewer-date]'),
                viewerBody: document.querySelector('[data-viewer-body]'),
                viewerMeta: document.querySelector('[data-viewer-meta]'),
                noteFolderSelect: document.querySelector('[data-note-folder]'),
                noteVisibilitySelect: document.querySelector('[data-note-visibility]'),
                identityForm: document.querySelector('[data-identity-form]'),
                identityInput: document.querySelector('[data-identity-input]'),
                identityId: document.querySelector('[data-identity-id]'),
                noteSync: document.querySelector('[data-note-sync]'),
                noteAlert: document.querySelector('[data-note-alert]')
            };

            const state = {
                folders: [],
                notes: []
            };

            let identity = loadIdentity();
            let activeFolderId = '';
            let activeNoteId = '';
            let offlineMode = false;

            function loadIdentity() {
                try {
                    const stored = localStorage.getItem(identityKey);
                    if (stored) {
                        const parsed = JSON.parse(stored);
                        if (parsed && parsed.ownerId) {
                            return {
                                ownerId: parsed.ownerId,
                                ownerName: parsed.ownerName || defaultDisplayName
                            };
                        }
                    }
                } catch (error) {
                    console.warn('Unable to parse stored identity', error);
                }
                const fresh = {
                    ownerId: generateOwnerId(),
                    ownerName: defaultDisplayName
                };
                localStorage.setItem(identityKey, JSON.stringify(fresh));
                return fresh;
            }

            function saveIdentity(next) {
                identity = next;
                localStorage.setItem(identityKey, JSON.stringify(identity));
            }

            function generateOwnerId() {
                return `visitor-${Math.random().toString(36).slice(2, 10)}`;
            }

            function cacheKey() {
                return `${cachePrefix}:${identity.ownerId}`;
            }

            function saveCache() {
                try {
                    localStorage.setItem(cacheKey(), JSON.stringify(state));
                } catch (error) {
                    console.warn('Unable to cache notes', error);
                }
            }

            function loadCache() {
                try {
                    const raw = localStorage.getItem(cacheKey());
                    if (!raw) return null;
                    const parsed = JSON.parse(raw);
                    if (parsed && Array.isArray(parsed.folders) && Array.isArray(parsed.notes)) {
                        return parsed;
                    }
                } catch (error) {
                    console.warn('Unable to read cached notes', error);
                }
                return null;
            }

            function setSyncStatus(message, tone = 'info') {
                if (!elements.noteSync) return;
                elements.noteSync.textContent = message;
                elements.noteSync.dataset.tone = tone;
            }

            function setAlert(message, tone = 'warning') {
                if (!elements.noteAlert) return;
                elements.noteAlert.hidden = !message;
                if (!message) {
                    elements.noteAlert.textContent = '';
                    elements.noteAlert.removeAttribute('data-tone');
                    return;
                }
                elements.noteAlert.textContent = message;
                elements.noteAlert.dataset.tone = tone;
            }

            function clearAlert() {
                setAlert('', '');
            }

            async function requestJSON(path, options = {}) {
                const headers = Object.assign({ Accept: 'application/json' }, options.headers || {});
                if (options.body && !headers['Content-Type']) {
                    headers['Content-Type'] = 'application/json';
                }
                const response = await fetch(`${API_BASE}${path}`, { ...options, headers });
                let payload = null;
                try {
                    payload = await response.json();
                } catch (error) {
                    payload = null;
                }
                if (!response.ok) {
                    const error = new Error((payload && payload.error) || `Request failed with status ${response.status}`);
                    error.payload = payload;
                    error.status = response.status;
                    throw error;
                }
                return payload;
            }

            async function refreshNotes(showStatus = true) {
                if (!identity.ownerId) return;
                if (showStatus) {
                    setSyncStatus('Syncing with steward server‚Ä¶');
                }
                try {
                    const data = await requestJSON(`/library/notes?ownerId=${encodeURIComponent(identity.ownerId)}`);
                    state.folders = Array.isArray(data.folders) ? data.folders : [];
                    state.notes = Array.isArray(data.notes) ? data.notes : [];
                    offlineMode = false;
                    setSyncStatus(`Connected ‚Äî ${state.notes.length} note(s) synced.`, 'success');
                    saveCache();
                } catch (error) {
                    offlineMode = true;
                    const cached = loadCache();
                    if (cached) {
                        state.folders = cached.folders;
                        state.notes = cached.notes;
                        setSyncStatus('Offline ‚Äî showing last saved notes.', 'warning');
                    } else {
                        state.folders = [];
                        state.notes = [];
                        setSyncStatus('Offline ‚Äî steward server unreachable.', 'error');
                    }
                    console.warn('Notes sync failed', error);
                }
                ensureActiveSelections();
                renderFolders();
                renderNotes();
                renderViewer();
                populateFolderSelect();
            }

            function ensureActiveSelections() {
                if (!state.folders.some((folder) => folder.id === activeFolderId)) {
                    activeFolderId = state.folders[0]?.id || '';
                }
                if (!state.notes.some((note) => note.id === activeNoteId && note.folderId === activeFolderId)) {
                    activeNoteId = state.notes.find((note) => note.folderId === activeFolderId)?.id || '';
                }
            }

            function renderFolders() {
                if (!elements.folderList) return;
                elements.folderList.innerHTML = '';
                const fragment = document.createDocumentFragment();
                state.folders.forEach((folder) => {
                    const item = document.createElement('li');
                    const button = document.createElement('button');
                    button.type = 'button';
                    button.className = `notes-panel__button${folder.id === activeFolderId ? ' is-active' : ''}`;
                    const label = document.createElement('span');
                    label.textContent = folder.name;
                    const badge = document.createElement('small');
                    badge.className = 'notes-panel__badge';
                    badge.textContent = folder.canEdit ? 'Personal' : 'Shared';
                    button.appendChild(label);
                    button.appendChild(badge);
                    button.addEventListener('click', () => {
                        activeFolderId = folder.id;
                        activeNoteId = state.notes.find((note) => note.folderId === activeFolderId)?.id || '';
                        renderFolders();
                        renderNotes();
                        renderViewer();
                        populateFolderSelect();
                    });
                    item.appendChild(button);
                    fragment.appendChild(item);
                });
                elements.folderList.appendChild(fragment);
                if (elements.folderEmpty) {
                    elements.folderEmpty.hidden = state.folders.length > 0;
                }
                updateActiveFolderLabel();
            }

            function updateActiveFolderLabel() {
                if (!elements.activeFolderLabel) return;
                if (!activeFolderId) {
                    elements.activeFolderLabel.textContent = 'Create a folder to start storing notes.';
                    return;
                }
                const folder = state.folders.find((entry) => entry.id === activeFolderId);
                elements.activeFolderLabel.textContent = folder
                    ? `Viewing notes in ‚Äú${folder.name}‚Äù.`
                    : 'Select a folder to see its notes.';
            }

            function renderNotes() {
                if (!elements.noteList) return;
                elements.noteList.innerHTML = '';
                const visibleNotes = state.notes
                    .filter((note) => note.folderId === activeFolderId)
                    .sort((a, b) => (new Date(b.updatedAt || b.createdAt || 0)) - (new Date(a.updatedAt || a.createdAt || 0)));
                const fragment = document.createDocumentFragment();
                visibleNotes.forEach((note) => {
                    const item = document.createElement('li');
                    const button = document.createElement('button');
                    button.type = 'button';
                    button.className = `notes-panel__button${note.id === activeNoteId ? ' is-active' : ''}`;
                    const title = document.createElement('span');
                    title.textContent = note.title;
                    const badge = document.createElement('small');
                    badge.className = 'notes-panel__badge';
                    badge.textContent = note.visibility === 'public' ? 'Public' : 'Private';
                    button.appendChild(title);
                    button.appendChild(badge);
                    button.addEventListener('click', () => {
                        activeNoteId = note.id;
                        renderNotes();
                        renderViewer();
                    });
                    item.appendChild(button);
                    fragment.appendChild(item);
                });
                elements.noteList.appendChild(fragment);
                if (elements.noteEmpty) {
                    elements.noteEmpty.hidden = visibleNotes.length > 0;
                }
                if (elements.noteCount) {
                    elements.noteCount.textContent = `${visibleNotes.length} entr${visibleNotes.length === 1 ? 'y' : 'ies'}`;
                }
            }

            function renderViewer() {
                if (!elements.noteViewer || !elements.viewerEmpty) return;
                const note = state.notes.find((entry) => entry.id === activeNoteId);
                if (!note) {
                    elements.noteViewer.hidden = true;
                    elements.viewerEmpty.hidden = false;
                    return;
                }
                elements.noteViewer.hidden = false;
                elements.viewerEmpty.hidden = true;
                if (elements.viewerTitle) {
                    elements.viewerTitle.textContent = note.title;
                }
                if (elements.viewerDate) {
                    const date = note.updatedAt || note.createdAt;
                    elements.viewerDate.textContent = date ? new Date(date).toLocaleString() : '';
                }
                if (elements.viewerBody) {
                    elements.viewerBody.textContent = note.content;
                }
                if (elements.viewerMeta) {
                    const visibilityLabel = note.visibility === 'public' ? 'Public annotation' : 'Private draft';
                    elements.viewerMeta.textContent = `${note.ownerName} ‚Ä¢ ${visibilityLabel}`;
                }
            }

            function populateFolderSelect() {
                if (!elements.noteFolderSelect) return;
                elements.noteFolderSelect.innerHTML = '';
                if (state.folders.length === 0) {
                    const option = document.createElement('option');
                    option.value = '';
                    option.textContent = 'No folders available yet';
                    elements.noteFolderSelect.appendChild(option);
                    elements.noteFolderSelect.disabled = true;
                    return;
                }
                state.folders.forEach((folder) => {
                    const option = document.createElement('option');
                    option.value = folder.id;
                    option.textContent = folder.canEdit ? folder.name : `${folder.name} (shared)`;
                    elements.noteFolderSelect.appendChild(option);
                });
                elements.noteFolderSelect.disabled = false;
                elements.noteFolderSelect.value = activeFolderId;
            }

            async function handleFolderSubmit(event) {
                event.preventDefault();
                clearAlert();
                if (!elements.folderInput) return;
                const name = elements.folderInput.value.trim();
                if (!name) {
                    setAlert('Name your folder before saving.', 'warning');
                    return;
                }
                if (offlineMode) {
                    setAlert('Reconnect to the steward server to create folders.', 'warning');
                    return;
                }
                try {
                    setAlert('Creating folder‚Ä¶', 'info');
                    const payload = await requestJSON('/library/note-folders', {
                        method: 'POST',
                        body: JSON.stringify({ ownerId: identity.ownerId, ownerName: identity.ownerName, name })
                    });
                    elements.folderForm.reset();
                    setAlert(`Folder ‚Äú${payload.folder.name}‚Äù created.`, 'success');
                    await refreshNotes(false);
                    activeFolderId = payload.folder.id;
                    renderFolders();
                    renderNotes();
                    renderViewer();
                    populateFolderSelect();
                } catch (error) {
                    setAlert(error.payload?.error || 'Unable to create folder right now.', 'error');
                }
            }

            async function handleNoteSubmit(event) {
                event.preventDefault();
                clearAlert();
                if (!elements.noteTitle || !elements.noteContent) return;
                const title = elements.noteTitle.value.trim();
                const content = elements.noteContent.value.trim();
                const folderId = elements.noteFolderSelect?.value || activeFolderId;
                const visibility = elements.noteVisibilitySelect?.value || 'private';
                if (!folderId) {
                    setAlert('Create and select a folder before writing notes.', 'warning');
                    return;
                }
                if (!title || !content) {
                    setAlert('Add a title and some reflections before saving.', 'warning');
                    return;
                }
                if (offlineMode) {
                    setAlert('Reconnect to the steward server to save notes.', 'warning');
                    return;
                }
                try {
                    setAlert('Saving note‚Ä¶', 'info');
                    const payload = await requestJSON('/library/notes', {
                        method: 'POST',
                        body: JSON.stringify({
                            ownerId: identity.ownerId,
                            ownerName: identity.ownerName || defaultDisplayName,
                            title,
                            content,
                            folderId,
                            visibility
                        })
                    });
                    elements.noteForm.reset();
                    setAlert('Note saved to the ledger.', 'success');
                    await refreshNotes(false);
                    activeFolderId = payload.note.folderId;
                    activeNoteId = payload.note.id;
                    renderFolders();
                    renderNotes();
                    renderViewer();
                    populateFolderSelect();
                } catch (error) {
                    setAlert(error.payload?.error || 'Unable to save note right now.', 'error');
                }
            }

            function handleIdentitySubmit(event) {
                event.preventDefault();
                if (!elements.identityInput) return;
                const name = elements.identityInput.value.trim() || defaultDisplayName;
                saveIdentity({ ownerId: identity.ownerId || generateOwnerId(), ownerName: name });
                updateIdentityUI();
                setAlert('Display name updated.', 'success');
            }

            function updateIdentityUI() {
                if (elements.identityInput) {
                    elements.identityInput.value = identity.ownerName || defaultDisplayName;
                }
                if (elements.identityId) {
                    elements.identityId.textContent = identity.ownerId;
                }
            }

            function attachEvents() {
                if (elements.folderForm) {
                    elements.folderForm.addEventListener('submit', handleFolderSubmit);
                }
                if (elements.noteForm) {
                    elements.noteForm.addEventListener('submit', handleNoteSubmit);
                }
                if (elements.identityForm) {
                    elements.identityForm.addEventListener('submit', handleIdentitySubmit);
                }
            }

            function init() {
                updateIdentityUI();
                attachEvents();
                refreshNotes();
            }

            init();
        })();
    </script>
</body>
</html>
